<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Realiza tu Pago</title>
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="styles.css" rel="stylesheet">
</head>
<body>

  <div class="container">
    <div class="text-center mb-4">
      <h2>Realiza tu Pago</h2>
      <p class="text-muted">Paso 2 de 3</p>
    </div>

    <!-- Monto -->
    <div class="alert alert-info">
      <strong>Monto a pagar:</strong> <span id="monto-display">Cargando...</span>
    </div>

    <!-- Datos de Pago -->
    <div class="payment-info">
      <h5 id="metodo-titulo">M√©todo de Pago</h5>
      <p id="datos-pago">Cargando...</p>
      <button class="btn btn-sm btn-outline-success btn-copy" onclick="copiarDatos()">üìã Copiar Datos</button>
    </div>

    <!-- Referencia -->
    <div class="mb-3">
      <label for="referencia" class="form-label">Referencia Bancaria (√∫ltimos 6 d√≠gitos)</label>
      <input type="text" class="form-control" id="referencia" maxlength="6" placeholder="Ej: 123456">
    </div>

    <!-- Comprobante -->
    <div class="mb-3">
      <label for="comprobante" class="form-label">Subir Comprobante de Pago</label>
      <input class="form-control" type="file" id="comprobante" accept="image/jpeg,image/png">
      <img id="preview" class="preview-img" alt="Vista previa">
      <small class="text-muted">Formatos: JPG o PNG (m√°x. 5 MB)</small>
    </div>

    <!-- Botones -->
    <div class="d-grid gap-2 mt-4">
      <button id="btn-enviar" class="btn btn-success">‚úÖ Enviar Comprobante</button>
      <a href="paso1.html" class="btn btn-outline-secondary">‚Üê Atr√°s</a>
    </div>
  </div>

  <!-- Bootstrap JS + Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // === Configuraci√≥n de datos de pago (EDITA ESTOS VALORES) ===
    const DATOS_PAGO = {
      mercantil: {
        titulo: "Pago M√≥vil Mercantil",
        datos: "Titular: Mar√≠a L√≥pez\nC√©dula: V-12345678\nTel√©fono: 0412-1234567"
      },
      zelle: {
        titulo: "Zelle",
        datos: "Email: rifasoficial@gmail.com\nTitular: Mar√≠a L√≥pez"
      },
      binance: {
        titulo: "Binance (USDT - TRC20)",
        datos: "Wallet: TABC1234567890XYZ\nRed: TRC20\nTitular: Mar√≠a L√≥pez"
      }
    };

    // === Cargar datos desde localStorage ===
    const metodo = localStorage.getItem('rifa_metodo_pago');
    const totalBs = parseFloat(localStorage.getItem('rifa_total_bs')) || 0;
    const totalUsd = parseFloat(localStorage.getItem('rifa_total_usd')) || 0;
    const qty = parseInt(localStorage.getItem('rifa_qty')) || 1;

    if (!metodo) {
      alert('No se seleccion√≥ un m√©todo de pago. Regresando...');
      window.location.href = 'paso1.html';
    }

    // Mostrar monto
    document.getElementById('monto-display').textContent = 
      `${totalBs.toLocaleString('es-VE', { minimumFractionDigits: 2 })} Bs. (${totalUsd.toFixed(2)} USD)`;

    // Mostrar datos de pago
    const info = DATOS_PAGO[metodo];
    if (info) {
      document.getElementById('metodo-titulo').textContent = info.titulo;
      document.getElementById('datos-pago').textContent = info.datos;
    } else {
      document.getElementById('datos-pago').textContent = "M√©todo no disponible.";
    }

    // === Copiar al portapapeles ===
    function copiarDatos() {
      const texto = document.getElementById('datos-pago').textContent;
      navigator.clipboard.writeText(texto).then(() => {
        const btn = document.querySelector('.btn-copy');
        const original = btn.innerHTML;
        btn.innerHTML = '‚úî Copiado!';
        setTimeout(() => btn.innerHTML = original, 2000);
      }).catch(err => {
        alert('No se pudo copiar. Intenta manualmente.');
      });
    }

    // === Vista previa del comprobante ===
    document.getElementById('comprobante').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const preview = document.getElementById('preview');
          preview.src = e.target.result;
          preview.style.display = 'block';
        };
        reader.readAsDataURL(file);
      }
    });

    // === Enviar ===
    document.getElementById('btn-enviar').addEventListener('click', function() {
      const referencia = document.getElementById('referencia').value.trim();
      const fileInput = document.getElementById('comprobante');
      
      if (!referencia) {
        alert('Por favor, ingresa la referencia bancaria.');
        return;
      }
      if (!fileInput.files.length) {
        alert('Por favor, sube el comprobante de pago.');
        return;
      }

      // Guardar en localStorage (simulaci√≥n de env√≠o)
      const file = fileInput.files[0];
      const reader = new FileReader();
      reader.onload = function() {
        const base64 = reader.result; // Imagen en base64

        // Guardar todo
        localStorage.setItem('rifa_referencia', referencia);
        localStorage.setItem('rifa_comprobante', base64);
        localStorage.setItem('rifa_compra_exitosa', 'true');

        // Mostrar mensaje y redirigir
        alert('¬°Comprobante enviado con √©xito!\nEl organizador verificar√° tu pago y te contactar√°.');
        window.location.href = 'index.html';
      };
      reader.readAsDataURL(file);
    });
  </script>
</body>
</html>
